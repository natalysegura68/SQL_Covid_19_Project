

--SELECTING DATA WE ARE GOING TO USE 

SELECT LOCATION,DATE, POPULATION, TOTAL_CASES, NEW_CASES,TOTAL_DEATHS
FROM MODEL.DBO.COVID_DEATHS
WHERE CONTINENT IS NOT NULL
ORDER BY 1,2

--LOOKING INTO TOTAL_CASES VS TOTAL_DEATHS (NEW COLUMN DEATH_PERCENTAGE IS THE PERCENTAGE OF PEOPLE THAT DIE IF THEY GET COVID 19)
--CHANCE OF DYING IF YOU GET COVID IN YOUR COUNTRY (HERE YOU CAN CHANGE THE LOCATION FOR ANY COUNTRY)

SELECT LOCATION,DATE,  TOTAL_CASES,TOTAL_DEATHS, (TOTAL_DEATHS/TOTAL_CASES)*100 AS 'DEATH_PERCENTAGE'
FROM MODEL.DBO.COVID_DEATHS
WHERE LOCATION='COLOMBIA' AND CONTINENT IS NOT NULL
ORDER BY 1,2

--LOOKING INTO TOTAL_CASES VS POPULATION (NEW COLUMN CASES_PERCENTAGE_BASED_ON_POPULATION IS THE PERCENTAGE OF CASES BASED ON COUNTRY POPULATION )
--HERE YOU CAN CHANGE THE LOCATION FOR ANY COUNTRY

SELECT LOCATION,DATE,  TOTAL_CASES,POPULATION, (TOTAL_CASES/POPULATION)*100 AS 'CASES_PERCENTAGE_BASED_ON_POPULATION'
FROM MODEL.DBO.COVID_DEATHS
WHERE LOCATION='COLOMBIA' AND  CONTINENT IS NOT NULL
ORDER BY 1,2

--LOOKING AT COUNTRIES WITH HIGHEST PERCENTAGE CASES COMPARE TO THEIR POPULATION.

SELECT LOCATION, POPULATION, MAX(TOTAL_CASES) AS 'HIGHEST_TOTAL_CASES', MAX((TOTAL_CASES/POPULATION))*100 AS 'HIGHEST_CASES_PERCENTAGE'
FROM MODEL.DBO.COVID_DEATHS
WHERE CONTINENT IS NOT NULL
GROUP BY LOCATION, POPULATION
ORDER BY 'HIGHEST_CASES_PERCENTAGE' DESC

--SHOWING THE COUNTRIES WITH HIGHEST DEATH PER POPULATION

SELECT LOCATION, MAX(total_deaths) AS MX_DEATHS, MAX((TOTAL_DEATHS/POPULATION))*100 AS DEATHS_PERCENTAGE
FROM MODEL.DBO.COVID_DEATHS
WHERE CONTINENT IS NOT NULL
GROUP BY LOCATION
ORDER BY MX_DEATHS DESC

--SHOWING THE CONTINENTS WITH HIGHEST DEATH PER POPULATION

SELECT LOCATION, POPULATION, MAX(total_deaths) AS MAX_DEATHS
FROM MODEL.DBO.COVID_DEATHS
WHERE CONTINENT IS NULL AND LOCATION NOT IN ('WORLD','HIGH INCOME','UPPER MIDDLE INCOME','LOWER MIDDLE INCOME','LOW INCOME')
GROUP BY LOCATION, POPULATION
ORDER BY MAX_DEATHS DESC

--GLOBAL NUMBERS (TOTAL DEATHS, TOTAL CASES AND DEATH PERCENTAGE AROUND THE WORLD)

SELECT LOCATION, POPULATION, MAX(total_deaths) AS MAX_DEATHS, MAX(total_cases) AS MAX_CASES, (MAX(total_deaths)/POPULATION)*100 AS 'DEATHS_%'
FROM MODEL.DBO.COVID_DEATHS
WHERE LOCATION='WORLD'
GROUP BY LOCATION, POPULATION
ORDER BY MAX_DEATHS DESC

SELECT SUM(NEW_CASES) AS 'TOTAL_CASES', SUM(NEW_DEATHS) AS 'TOTAL DEATHS',(SUM(NEW_DEATHS)/SUM(NEW_CASES))*100 AS 'DEATHS_%'
FROM MODEL.DBO.COVID_DEATHS
WHERE CONTINENT IS NOT NULL

-- JOIN COVID_DEATHS AND COVID_VACCINATIONS
--LOOKING AT TOTAL POPULATION VS VACCIONATION (NEW COLUMN ROLLING_PEOPLE_VACCINATED IS THE TOTAL PEOPLE IS BEEN VACCINATED AT THAT DATE)

--CTE
WITH POPVSVACC (CONTINENT,LOCATION,DATE,POPULATION, NEW_VACCINATIONS,ROLLING_PEOPLE_VACCINATED)
AS 
(SELECT DEATHS.CONTINENT, DEATHS.LOCATION,DEATHS.DATE,POPULATION, VAX.new_vaccinations,
SUM(VAX.new_vaccinations) OVER (PARTITION BY DEATHS.LOCATION ORDER BY DEATHS.LOCATION, DEATHS.DATE) AS ROLLING_PEOPLE_VACCINATED
FROM MODEL.DBO.COVID_DEATHS AS DEATHS 
JOIN MODEL.DBO.COVID_VACCINATIONS AS VAX
ON DEATHS.LOCATION= VAX.LOCATION 
AND DEATHS.DATE=VAX.DATE
WHERE DEATHS.CONTINENT IS NOT NULL AND VAX.new_vaccinations IS NOT NULL)

SELECT *,(ROLLING_PEOPLE_VACCINATED/POPULATION)*100 AS 'POPVAX%'
FROM POPVSVACC

---CREATING A VIEW TO STORE DATA FOR LATER VISUALIZATIONS

CREATE VIEW POPVSVACC AS

SELECT DEATHS.CONTINENT, DEATHS.LOCATION,DEATHS.DATE,POPULATION, VAX.new_vaccinations,
SUM(VAX.new_vaccinations) OVER (PARTITION BY DEATHS.LOCATION ORDER BY DEATHS.LOCATION, DEATHS.DATE) AS ROLLING_PEOPLE_VACCINATED
FROM MODEL.DBO.COVID_DEATHS AS DEATHS 
JOIN MODEL.DBO.COVID_VACCINATIONS AS VAX
ON DEATHS.LOCATION= VAX.LOCATION 
AND DEATHS.DATE=VAX.DATE
WHERE DEATHS.CONTINENT IS NOT NULL AND VAX.new_vaccinations IS NOT NULL

SELECT*
FROM POPVSVACC
